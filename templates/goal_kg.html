{% extends 'base.html' %}
{% block title %}Zielsetzung KG{% endblock %}
{% block content %}
<section x-data="goalKG()" class="grid gap-4 md:gap-6">
    <form hx-post="/api/goals/" hx-swap="none" @htmx:afterRequest="updateSmart" class="card grid gap-4 md:gap-5">
        <input type="hidden" name="user_session" value="{{ user_session_id }}">
        <label class="grid gap-1">
            <span class="text-sm font-medium">Was m√∂chtest du erreichen?</span>
            <textarea name="raw_text" class="w-full rounded-xl border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"></textarea>
        </label>
        <div class="flex gap-3">
            <button class="btn-primary w-full sm:w-auto" type="submit">Ziel speichern</button>
            <a href="{% url 'dashboard' %}" class="btn-ghost">Abbrechen</a>
        </div>
    </form>
    <div class="flex flex-wrap gap-2 text-xs">
        <template x-for="(val, key) in smart" :key="key">
            <span class="badge" :class="val ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300' : ''" x-text="key"></span>
        </template>
    </div>
</section>
<script>
function goalKG(){
    return {
        smart:{specific:false, measurable:false, achievable:false, relevant:false, time_bound:false},
        updateSmart(e){
            let data={};
            try{ data = JSON.parse(e.detail.xhr.responseText);}catch(err){}
            if(data.smart_score){ this.smart = data.smart_score; }
            if(e.detail.successful){ window.location.href='/dashboard/'; }
        }
    }
}
</script>
{% endblock %}
